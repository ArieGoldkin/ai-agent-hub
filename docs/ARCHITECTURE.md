# AI Agent Hub - Architecture Documentation

> **Version**: 3.5.9
> **Last Updated**: 2025-01-18

This document explains the architecture of the ai-agent-hub NPM package, including the source-to-installation transformation and package components.

---

## üìê Architecture Overview

### Source vs. Generated

AI Agent Hub follows a **source repository ‚Üí installed configuration** architecture where the NPM package contains source materials that are transformed during installation.

#### This Repository (Source)

**Purpose**: Package development and maintenance

**Structure**:
- **SOURCE FILES**: `/agents/`, `/assets/`, `/skills/`
- No `.claude/` folder (gitignored)
- Full TypeScript source in `/lib/`
- Build tooling and dev dependencies
- Package maintenance and publishing

**Key Points**:
- Agents are defined in `/agents/*.md`
- Instruction templates in `/assets/instructions/*.md`
- Skills in `/skills/*/SKILL.md`
- TypeScript CLI in `/lib/` and `/bin/`
- Squad mode files in `/.squad/`

#### After Installation (User's Project)

**Purpose**: Using the AI agent system

**Structure**: `.claude/` folder created fresh (v3.5.9+ unified structure)

```
.claude/
‚îú‚îÄ‚îÄ agents/              # Copied from /agents/
‚îú‚îÄ‚îÄ instructions/        # Copied from /assets/instructions/
‚îú‚îÄ‚îÄ skills/              # Copied from /skills/ (v3.5.9+)
‚îú‚îÄ‚îÄ context/             # Freshly initialized
‚îÇ   ‚îî‚îÄ‚îÄ shared-context.json
‚îú‚îÄ‚îÄ commands/            # Squad mode only (from /.squad/commands/)
‚îú‚îÄ‚îÄ examples/            # Squad mode only (from /.squad/examples/)
‚îú‚îÄ‚îÄ context-triggers.md  # Copied from /assets/
‚îî‚îÄ‚îÄ settings.local.json  # Generated MCP configuration

CLAUDE.md               # Generated by /lib/claude-md-generator/
.mcp.json               # Generated MCP server config
```

**Transformation Flow**:
1. User runs `npx ai-agent-hub`
2. CLI detects mode (classic vs squad)
3. Creates `.claude/` directory structure
4. Copies agents from `/agents/` ‚Üí `.claude/agents/`
5. Copies instructions from `/assets/instructions/` ‚Üí `.claude/instructions/`
6. Copies skills from `/skills/` ‚Üí `.claude/skills/` (v3.5.9+)
7. Squad mode: copies additional files to `.claude/instructions/`, `.claude/commands/`, `.claude/examples/`
8. Generates `CLAUDE.md` dynamically based on mode
9. Creates `.mcp.json` with MCP server configuration
10. Initializes context system in `.claude/context/`

**Key Principle**: Focus on **using agents**, not building them.

---

## üìö Package Components

### Agents (10 Specialists)

AI Agent Hub includes 10 specialized agent personalities, each with distinct capabilities:

| Agent | File | Primary Focus |
|-------|------|---------------|
| **Studio Coach** | `studio-coach.md` | Master orchestrator, coordinates all agents |
| **Sprint Prioritizer** | `sprint-prioritizer.md` | Agile planning, task breakdown, estimation |
| **Product Manager** | `product-manager.md` | Product strategy, roadmap planning, PRDs |
| **UX Researcher** | `ux-researcher.md` | User research, requirements gathering |
| **Rapid UI Designer** | `rapid-ui-designer.md` | Design systems, UI prototyping |
| **Backend System Architect** | `backend-system-architect.md` | API design, database schema, system architecture |
| **Frontend UI Developer** | `frontend-ui-developer.md` | UI implementation, component development |
| **AI/ML Engineer** | `ai-ml-engineer.md` | Machine learning features, AI integration |
| **Whimsy Injector** | `whimsy-injector.md` | Delightful interactions, creative enhancements |
| **Code Quality Reviewer** | `code-quality-reviewer.md` | Code review, quality assurance, security |

**Storage**:
- **Source**: `/agents/*.md` (this repo)
- **Installed**: `.claude/agents/*.md` (user's project)

**Squad Mode Variants**:
- Classic: Full agent definitions (~3-5KB each)
- Squad: Slim templates (~300 bytes) + analysis files in `/.squad/`

### Skills (14 Knowledge Modules)

Specialized knowledge modules that Claude references on-demand:

| Skill | Domain | Key Features |
|-------|--------|--------------|
| **ai-native-development** | AI/ML | RAG pipelines, embeddings, vector DBs |
| **api-design-framework** | Backend | REST/GraphQL/gRPC patterns |
| **architecture-decision-record** | Architecture | ADR templates, decision documentation |
| **code-review-playbook** | Quality | Conventional comments, review workflows |
| **database-schema-designer** | Backend | SQL/NoSQL schema design, migrations |
| **design-system-starter** | Frontend | Design tokens, component architecture |
| **edge-computing-patterns** | Infrastructure | Cloudflare Workers, Vercel Edge |
| **evidence-verification** | Quality | Proof-based verification (v3.5.0) |
| **quality-gates** | Quality | Complexity assessment, blocking rules (v3.5.0) |
| **react-server-components-framework** | Frontend | Next.js 15, RSC, Server Actions |
| **security-checklist** | Security | OWASP Top 10, security audits |
| **streaming-api-patterns** | Backend | SSE, WebSockets, real-time APIs |
| **testing-strategy-builder** | Quality | Test planning, coverage strategies |
| **type-safety-validation** | TypeScript | Zod, tRPC, end-to-end type safety |

**Storage**:
- **Source**: `/skills/*/SKILL.md` (this repo)
- **Installed**: `.claude/skills/*/SKILL.md` (user's project, v3.5.9+)

**Structure**: Each skill contains:
- `SKILL.md` - Core framework (~300-400 lines)
- `templates/` - Reusable file templates
- `references/` - Detailed code examples
- `checklists/` - Verification checklists

### Instruction Files

Orchestration and context management rules:

| File | Purpose | Mode |
|------|---------|------|
| `orchestration.md` | Agent routing, coordination rules | All |
| `agents.md` | Full agent capabilities reference | All |
| `context.md` | Context persistence system | All |
| `workflows.md` | Multi-step project patterns | All |
| `context-middleware.md` | Context protocol (auto-loaded) | All |
| `cli-integration.md` | Claude Code CLI behavior | All |
| `super-design.md` | UI/frontend design workflow | All |
| `supervisor-rules.md` | Squad supervisor orchestration | Squad only |
| `squad-roster.md` | Agent assignments & capabilities | Squad only |
| `communication-protocol.md` | File-based messaging | Squad only |
| `parallel-execution-rules.md` | Conflict prevention | Squad only |
| `architecture-decisions.md` | Shared architectural context | Squad only |

**Storage**:
- **Source**: `/assets/instructions/*.md` (this repo)
- **Installed**: `.claude/instructions/*.md` (user's project)

### CLI Components

TypeScript-based installation and generation system:

| Directory | Purpose |
|-----------|---------|
| `/lib/` | Core TypeScript libraries |
| `/lib/cli/` | CLI argument parsing, mode detection |
| `/lib/claude-md-generator/` | Dynamic CLAUDE.md generation |
| `/bin/` | CLI commands and entry points |
| `/bin/commands/` | Installation commands |
| `/bin/commands/install-agents/` | Agent installation logic |
| `/bin/commands/components/` | Reusable installation components |

**Build Output**: Compiled to `/dist/` (published to NPM)

### MCP Server Configuration

Pre-configured MCP servers for enhanced capabilities:

| Server | Purpose | Token Cost |
|--------|---------|-----------|
| **memory** | Persistent context across sessions | ~1.5K |
| **sequential-thinking** | Multi-step reasoning | ~2K |
| **context7** | Library documentation lookup | ~3.5K |

**Optional Servers** (user can add):
- **browsermcp** - Browser automation
- **shadcn** - UI component integration

**Configuration**:
- **Source**: Template in code
- **Installed**: `.mcp.json` in user's project

---

## üîÑ Installation Modes

### Classic Mode (Default)

**Characteristics**:
- Full agent prompts (~3-5KB each)
- Sequential execution
- Total context: ~37,500 tokens
- Best for: Simple tasks, small projects

**Files Created**:
- `.claude/agents/` - Full agent definitions
- `.claude/instructions/` - 9 instruction files
- `.claude/skills/` - 14 skill modules
- `.claude/context/` - Context system
- `CLAUDE.md` - ~100 lines, references modular files

### Squad Mode

**Characteristics**:
- Slim agent templates (~300 bytes each)
- Parallel execution (up to 4 agents)
- Token reduction: 97%
- Supervisor orchestration
- Best for: Complex features, large projects

**Additional Files Created**:
- `.claude/instructions/` - 5 additional squad files
- `.claude/commands/` - Parallel execution commands
- `.claude/examples/` - Workflow examples
- `CLAUDE.md` - Includes squad-specific instructions

**Token Savings**:
- Classic: ~37,500 tokens
- Squad: ~1,125 tokens (97% reduction)

---

## üß† Context System Architecture

### File-Based Context Storage

**Location**: `.claude/context/shared-context.json`

**Structure**:
```json
{
  "sessions": [
    {
      "timestamp": "2025-01-18T10:00:00Z",
      "agent": "backend-system-architect",
      "decisions": [],
      "evidence": [],
      "context": {}
    }
  ]
}
```

**Purpose**:
- Share context between agents
- Persist decisions across sessions
- Store quality evidence
- Track architectural choices

### Context Middleware

**Auto-loaded Protocol**: `.claude/instructions/context-middleware.md`

**Triggers**:
- When any agent is activated
- Before task execution
- After task completion

**Responsibilities**:
- Read existing context
- Record decisions and evidence
- Update shared context file
- Coordinate multi-agent tasks

---

## üì¶ Publishing Architecture

### What Gets Published to NPM

```
ai-agent-hub@3.5.9/
‚îú‚îÄ‚îÄ dist/                 # Compiled TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ bin/
‚îÇ   ‚îî‚îÄ‚îÄ lib/
‚îú‚îÄ‚îÄ agents/               # Source agent definitions
‚îú‚îÄ‚îÄ assets/               # Source instruction templates
‚îú‚îÄ‚îÄ skills/               # Source skill modules
‚îú‚îÄ‚îÄ .squad/               # Squad mode source files
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îî‚îÄ‚îÄ LICENSE
```

### What Doesn't Get Published

- `/docs/` - Development documentation (not needed by users)
- `.claude/` - Never exists in source repo (gitignored)
- `/src/` or `/lib/` source - Only compiled `/dist/`
- Development tooling configs (except TypeScript configs)

### Installation Flow

1. User runs: `npx ai-agent-hub@latest`
2. NPM downloads package to temp location
3. CLI executes from `/dist/bin/cli.js`
4. CLI reads source files from package directory
5. CLI generates `.claude/` structure in user's project
6. CLI copies/generates all necessary files
7. User's project now has complete setup

---

## üéØ Design Principles

1. **Source Separation**: Keep source materials separate from generated configurations
2. **Installation Transformation**: Generate optimal structure during installation
3. **Mode Flexibility**: Support both classic and squad modes from same source
4. **Progressive Disclosure**: Load context only when needed (token optimization)
5. **Version Independence**: Each installation is self-contained
6. **Migration Safety**: Provide tools to update existing installations

---

*For implementation details, see [DEVELOPMENT-GUIDE.md](./DEVELOPMENT-GUIDE.md)*
*For version-specific changes, see [docs/migrations/](./migrations/)*

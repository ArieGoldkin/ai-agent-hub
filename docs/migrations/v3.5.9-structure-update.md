# Migration Guide: v3.5.9 Structure Update

> **Version**: 3.5.9
> **Release Date**: 2025-01-18
> **Migration Type**: Breaking (File Structure)

This guide documents the major file structure reorganization in v3.5.9 and provides migration instructions for existing installations.

---

## üìã Overview

Version 3.5.9 introduces a unified `.claude/` structure following Anthropic's recommended patterns. All Claude-related resources are now organized under the `.claude/` directory for better discoverability and cleaner project structure.

### What Changed

**Before v3.5.9:**
```
project/
‚îú‚îÄ‚îÄ .claude/
‚îÇ   ‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ instructions/
‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îú‚îÄ‚îÄ supervisor-rules.md          ‚ùå Wrong location
‚îÇ   ‚îú‚îÄ‚îÄ squad-roster.md               ‚ùå Wrong location
‚îÇ   ‚îú‚îÄ‚îÄ communication-protocol.md     ‚ùå Wrong location
‚îÇ   ‚îú‚îÄ‚îÄ architecture-decisions.md     ‚ùå Wrong location
‚îÇ   ‚îú‚îÄ‚îÄ parallel-execution-rules.md   ‚ùå Wrong location
‚îÇ   ‚îî‚îÄ‚îÄ settings.local.json
‚îú‚îÄ‚îÄ skills/                           ‚ùå Wrong location
‚îÇ   ‚îú‚îÄ‚îÄ api-design-framework/
‚îÇ   ‚îî‚îÄ‚îÄ ... (14 skills)
‚îî‚îÄ‚îÄ CLAUDE.md
```

**After v3.5.9:**
```
project/
‚îú‚îÄ‚îÄ .claude/
‚îÇ   ‚îú‚îÄ‚îÄ agents/
‚îÇ   ‚îú‚îÄ‚îÄ instructions/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orchestration.md
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ supervisor-rules.md         ‚úÖ Moved
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ squad-roster.md             ‚úÖ Moved
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ communication-protocol.md   ‚úÖ Moved
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ architecture-decisions.md   ‚úÖ Moved
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parallel-execution-rules.md ‚úÖ Moved
‚îÇ   ‚îú‚îÄ‚îÄ skills/                         ‚úÖ Moved
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api-design-framework/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ... (14 skills)
‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îú‚îÄ‚îÄ commands/        (squad mode)
‚îÇ   ‚îú‚îÄ‚îÄ examples/        (squad mode)
‚îÇ   ‚îî‚îÄ‚îÄ settings.local.json
‚îî‚îÄ‚îÄ CLAUDE.md
```

---

## üéØ Why This Change?

### Problems with Old Structure

1. **Inconsistent Organization**
   - Skills in project root clutter the workspace
   - Squad files scattered in `.claude/` root
   - No clear pattern for Claude-related resources

2. **Poor Discoverability**
   - Claude Desktop/Code may not find resources
   - Developers confused about where to look
   - Mixing Claude files with project files

3. **Not Following Best Practices**
   - Anthropic recommends unified `.claude/` structure
   - Open-source Claude projects use consistent patterns
   - Harder to maintain as project grows

### Benefits of New Structure

1. **Unified Organization**
   - All Claude resources under `.claude/`
   - Clear separation: agents, instructions, skills, context
   - Easy to understand and navigate

2. **Better Discoverability**
   - Claude Desktop/Code can find all resources
   - Predictable file locations
   - Consistent across projects

3. **Cleaner Project Root**
   - No `skills/` clutter
   - Only essential project files visible
   - Professional appearance

4. **Scalability**
   - Easy to add new skills
   - Clear place for new instruction files
   - Room for future enhancements

---

## üîÑ Migration Instructions

### Automatic Migration (Recommended)

The easiest way to migrate is using the built-in migration command:

```bash
# Navigate to your project
cd /path/to/your/project

# Run migration
npx ai-agent-hub migrate
```

**What the migration does:**
1. Detects if migration is needed
2. Moves `skills/` to `.claude/skills/`
3. Moves squad infrastructure files to `.claude/instructions/`
4. Provides detailed report of changes
5. Safe to run multiple times (idempotent)

**Output Example:**
```
üîÑ Migrating to v3.5.9+ file structure...

üì¶ Moving skills/ to .claude/skills/...
   ‚úì Skills migrated successfully
   ‚úì Moved supervisor-rules.md to instructions/
   ‚úì Moved squad-roster.md to instructions/

‚úÖ Migration complete!

üì¶ Files moved:
   ‚úì skills/ ‚Üí .claude/skills/
   ‚úì .claude/supervisor-rules.md ‚Üí .claude/instructions/supervisor-rules.md
   ‚úì .claude/squad-roster.md ‚Üí .claude/instructions/squad-roster.md
```

### Manual Migration

If you prefer manual migration or need to understand the process:

#### Step 1: Backup Current Setup

```bash
# Create backup
tar -czf claude-backup-$(date +%Y%m%d).tar.gz .claude skills CLAUDE.md
```

#### Step 2: Move Skills Directory

```bash
# Move skills to .claude/
mv skills .claude/skills
```

#### Step 3: Move Squad Infrastructure Files (Squad Mode Only)

```bash
# Move to instructions directory
mv .claude/supervisor-rules.md .claude/instructions/
mv .claude/squad-roster.md .claude/instructions/
mv .claude/communication-protocol.md .claude/instructions/
mv .claude/architecture-decisions.md .claude/instructions/
mv .claude/parallel-execution-rules.md .claude/instructions/
```

#### Step 4: Verify Structure

```bash
# Check structure
tree -L 2 .claude/

# Should show:
# .claude/
# ‚îú‚îÄ‚îÄ agents/
# ‚îú‚îÄ‚îÄ instructions/
# ‚îÇ   ‚îú‚îÄ‚îÄ orchestration.md
# ‚îÇ   ‚îú‚îÄ‚îÄ supervisor-rules.md
# ‚îÇ   ‚îî‚îÄ‚îÄ ...
# ‚îú‚îÄ‚îÄ skills/
# ‚îÇ   ‚îú‚îÄ‚îÄ api-design-framework/
# ‚îÇ   ‚îî‚îÄ‚îÄ ...
# ‚îú‚îÄ‚îÄ context/
# ‚îî‚îÄ‚îÄ settings.local.json
```

#### Step 5: Update CLAUDE.md (Optional)

If you want the latest CLAUDE.md format:

```bash
# Reinstall (preserves .claude/)
npx ai-agent-hub@latest --project-only

# Or regenerate manually
rm CLAUDE.md
npx ai-agent-hub@latest --project-only
```

---

## üß™ Testing After Migration

### Verification Checklist

- [ ] `.claude/skills/` exists with 14 skills
- [ ] Root `skills/` directory removed
- [ ] Squad files in `.claude/instructions/` (if squad mode)
- [ ] No squad files in `.claude/` root
- [ ] `CLAUDE.md` references updated paths (if regenerated)
- [ ] Claude Desktop/Code can find agents
- [ ] Context system still works

### Testing Commands

```bash
# Check skills location
ls -la .claude/skills/
# Should list 14 skill directories

# Check skills are NOT in root
ls skills/ 2>&1
# Should show "No such file or directory"

# Check squad files (if squad mode)
ls .claude/instructions/ | grep -E "(supervisor|squad|communication|parallel|architecture)"
# Should show the 5 squad files

# Test with Claude
# Open Claude Desktop/Code and try:
# "Use Backend System Architect to design an API"
```

---

## üîç Files Affected

### Skills Installer

**File**: `bin/commands/install-agents/skills-installer.ts`

**Changes**:
- Line 15: `const targetDir = ".claude/skills";` (was `"skills"`)
- Line 33: Updated count from 7 to 14 skills
- Line 34-47: Added 7 missing skills to output

### Squad Installer

**File**: `bin/commands/components/squad-installer.ts`

**Changes**:
- Line 62: `const destPath = ".claude/instructions/parallel-execution-rules.md";`
- Line 98: `const destPath = join(".claude", "instructions", file);`

### CLAUDE.md Generator

**File**: `lib/claude-md-generator/generators/modular/minimal-claudemd.ts`

**Changes**:
- Line 23: Version updated to 3.5.9
- Line 101: Updated path from `/skills/` to `.claude/skills/`
- Line 120: Updated skill reference paths
- Lines 49-54: Added squad instruction files (conditional on mode)
- Lines 155-173: Added new project structure section

### Documentation

**Files Updated**:
- `CHANGELOG.md` - v3.5.9 release notes
- `README.md` - Updated to 14 skills, new paths
- `bin/commands/help.ts` - Added migrate command, 10 agents
- `bin/commands/setup.ts` - 10 agents in output
- `bin/cli.ts` - Version bump, migrate command handler
- Root `CLAUDE.md` - v3.5.9 documentation

---

## üêõ Troubleshooting

### Issue: Migration Command Not Found

**Symptom**: `npx ai-agent-hub migrate` returns "command not found"

**Solution**:
```bash
# Update to latest version
npx ai-agent-hub@latest migrate

# Or explicitly specify version
npx ai-agent-hub@3.5.9 migrate
```

### Issue: Skills Still in Root

**Symptom**: Both `skills/` and `.claude/skills/` exist

**Solution**:
```bash
# Check if skills are duplicated
diff -r skills .claude/skills

# If identical, remove root skills
rm -rf skills
```

### Issue: Claude Can't Find Skills

**Symptom**: Claude doesn't load skills when requested

**Solution**:
1. Verify path: `ls .claude/skills/api-design-framework/SKILL.md`
2. Regenerate CLAUDE.md: `npx ai-agent-hub@latest --project-only`
3. Restart Claude Desktop/Code
4. Check CLAUDE.md references `.claude/skills/` paths

### Issue: Squad Files Missing

**Symptom**: Squad mode doesn't work after migration

**Solution**:
```bash
# Reinstall squad mode
npx ai-agent-hub@latest --project-only --mode squad

# Verify files
ls .claude/instructions/ | grep -E "(supervisor|squad)"
ls .claude/commands/
ls .claude/examples/
```

### Issue: Context System Broken

**Symptom**: Context not persisting across sessions

**Solution**:
```bash
# Check context file exists
ls -la .claude/context/shared-context.json

# If missing, reinitialize
rm -rf .claude/context
npx ai-agent-hub@latest --project-only
```

---

## üìä Impact Analysis

### Breaking Changes

- ‚úÖ **Skills Location**: Moved from root to `.claude/skills/`
- ‚úÖ **Squad Files**: Moved to `.claude/instructions/`
- ‚ö†Ô∏è **Custom Scripts**: If you have scripts referencing `skills/`, update paths

### Non-Breaking Changes

- ‚úÖ Agent files remain in `.claude/agents/`
- ‚úÖ Context system remains in `.claude/context/`
- ‚úÖ Settings remain in `.claude/settings.local.json`
- ‚úÖ MCP configuration remains in `.mcp.json`

### Required Actions

| Installation Type | Action Required |
|-------------------|----------------|
| **Fresh Install** (v3.5.9+) | None - automatically correct |
| **Existing Classic Mode** | Run `npx ai-agent-hub migrate` |
| **Existing Squad Mode** | Run `npx ai-agent-hub migrate` |
| **Custom Modifications** | Review and update file paths |

---

## üìù Code Examples

### Before: Loading Skills (Old Path)

```typescript
// Old code (will break after migration)
const skillPath = 'skills/api-design-framework/SKILL.md';
const skillContent = await readFile(skillPath);
```

### After: Loading Skills (New Path)

```typescript
// New code (v3.5.9+)
const skillPath = '.claude/skills/api-design-framework/SKILL.md';
const skillContent = await readFile(skillPath);
```

### Before: Referencing Squad Files

```markdown
<!-- Old reference -->
Read `.claude/supervisor-rules.md` for orchestration
```

### After: Referencing Squad Files

```markdown
<!-- New reference -->
Read `.claude/instructions/supervisor-rules.md` for orchestration
```

---

## üéì Best Practices Post-Migration

1. **Always Use New Paths**
   - Reference `.claude/skills/` not `skills/`
   - Reference `.claude/instructions/` for all instruction files

2. **Update Custom Scripts**
   - Search codebase for old paths
   - Update build scripts, deployment scripts, etc.

3. **Document Changes**
   - Update team documentation
   - Notify collaborators of migration

4. **Test Thoroughly**
   - Verify all agent activations work
   - Test skill loading
   - Check squad mode (if applicable)

---

## üîÆ Future Migrations

This migration establishes the pattern for future updates:

1. **Automated Migration Command**: Easy one-command upgrades
2. **Safe Idempotent Operations**: Can run multiple times safely
3. **Detailed Reporting**: Clear feedback on what changed
4. **Backward Compatibility**: Detects and handles old structures

Future versions will follow this pattern for smooth upgrades.

---

## üìö Related Documentation

- [ARCHITECTURE.md](../ARCHITECTURE.md) - Updated architecture documentation
- [DEVELOPMENT-GUIDE.md](../DEVELOPMENT-GUIDE.md) - Development workflow
- [CHANGELOG.md](../../CHANGELOG.md) - Full v3.5.9 changelog
- [README.md](../../README.md) - User-facing documentation

---

**Need Help?**

- Open an issue: https://github.com/ArieGoldkin/ai-agent-hub/issues
- Check CHANGELOG.md for additional context
- Review ARCHITECTURE.md for structure details

---

*Migration guide for v3.5.9 structure update. For other version migrations, see [docs/migrations/](./)*
